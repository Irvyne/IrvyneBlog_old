!function(b){var a=function(d,c){this.$element=b(d);this.options=b.extend({},b.fn.collection.defaults,c);var e="div"+this.options.collection_id+" .collection-item";this.options.index=b(e).length-1};a.prototype={constructor:a,add:function(){this.options.index=this.options.index+1;var c=this.options.index;if(b.isFunction(this.options.addcheckfunc)&&!this.options.addcheckfunc()){if(b.isFunction(this.options.addfailedfunc)){this.options.addfailedfunc()}return}this.addPrototype(c)},addPrototype:function(c){var d=b(this.options.collection_id).attr("data-prototype").replace(/__name__/g,c);var e=b(d);b("div"+this.options.collection_id+"> .controls").append(e);b(this.options.collection_id).trigger("add.mopa-collection-item",[e])},remove:function(){if(this.$element.parents(".collection-item").length!==0){var c=this.$element.closest(".collection-item");c.remove()}}};b.fn.collection=function(c){return this.each(function(){var g=b(this),e=g.data("collection-add-btn"),f=g.data("collection"),d=typeof c=="object"?c:{};if(e){d.collection_id=e}else{if(g.closest(".control-group").attr("id")){d.collection_id="#"+g.closest(".control-group").attr("id")}else{d.collection_id=this.id.length===0?"":"#"+this.id}}if(!f){g.data("collection",(f=new a(this,d)))}if(c=="add"){f.add()}if(c=="remove"){f.remove()}})};b.fn.collection.defaults={collection_id:null,addcheckfunc:false,addfailedfunc:false};b.fn.collection.Constructor=a;b(function(){b("body").on("click.collection.data-api","[data-collection-add-btn]",function(d){var c=b(d.target);if(!c.hasClass("btn")){c=c.closest(".btn")}c.collection("add");d.preventDefault()});b("body").on("click.collection.data-api","[data-collection-remove-btn]",function(d){var c=b(d.target);if(!c.hasClass("btn")){c=c.closest(".btn")}c.collection("remove");d.preventDefault()})})}(window.jQuery);